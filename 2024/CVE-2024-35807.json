{
	"name": "CVE-2024-35807",
	"threat_severity": "Moderate",
	"public_date": "2024-05-17T00:00:00Z",
	"bugzilla": {
		"description": "kernel: ext4: fix corruption during on-line resize",
		"id": "2281221",
		"url": "https://bugzilla.redhat.com/show_bug.cgi?id=2281221"
	},
	"cvss3": {
		"cvss3_base_score": "5.5",
		"cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
		"status": "verified"
	},
	"details": [
		"In the Linux kernel, the following vulnerability has been resolved:\next4: fix corruption during on-line resize\nWe observed a corruption during on-line resize of a file system that is\nlarger than 16 TiB with 4k block size. With having more then 2^32 blocks\nresize_inode is turned off by default by mke2fs. The issue can be\nreproduced on a smaller file system for convenience by explicitly\nturning off resize_inode. An on-line resize across an 8 GiB boundary (the\nsize of a meta block group in this setup) then leads to a corruption:\ndev=/dev/<some_dev> # should be >= 16 GiB\nmkdir -p /corruption\n/sbin/mke2fs -t ext4 -b 4096 -O ^resize_inode $dev $((2 * 2**21 - 2**15))\nmount -t ext4 $dev /corruption\ndd if=/dev/zero bs=4096 of=/corruption/test count=$((2*2**21 - 4*2**15))\nsha1sum /corruption/test\n# 79d2658b39dcfd77274e435b0934028adafaab11  /corruption/test\n/sbin/resize2fs $dev $((2*2**21))\n# drop page cache to force reload the block from disk\necho 1 > /proc/sys/vm/drop_caches\nsha1sum /corruption/test\n# 3c2abc63cbf1a94c9e6977e0fbd72cd832c4d5c3  /corruption/test\n2^21 = 2^15*2^6 equals 8 GiB whereof 2^15 is the number of blocks per\nblock group and 2^6 are the number of block groups that make a meta\nblock group.\nThe last checksum might be different depending on how the file is laid\nout across the physical blocks. The actual corruption occurs at physical\nblock 63*2^15 = 2064384 which would be the location of the backup of the\nmeta block group's block descriptor. During the on-line resize the file\nsystem will be converted to meta_bg starting at s_first_meta_bg which is\n2 in the example - meaning all block groups after 16 GiB. However, in\next4_flex_group_add we might add block groups that are not part of the\nfirst meta block group yet. In the reproducer we achieved this by\nsubstracting the size of a whole block group from the point where the\nmeta block group would start. This must be considered when updating the\nbackup block group descriptors to follow the non-meta_bg layout. The fix\nis to add a test whether the group to add is already part of the meta\nblock group or not.",
		"A vulnerability was found in the ext4 filesystem in the Linux kernel during on-line resizing operations. When an ext4 filesystem is resized while mounted, it could lead to data corruption."
	],
	"references": [
		"https://www.cve.org/CVERecord?id=CVE-2024-35807\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-35807\nhttps://lore.kernel.org/linux-cve-announce/2024051740-CVE-2024-35807-2a9e@gregkh/T"
	],
	"mitigation": {
		"lang": "en:us",
		"value": "Mitigation for this issue is either not available or the currently available options do not meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability."
	},
	"affected_release": [
		{
			"advisory": "RHSA-2024:5102",
			"cpe": "cpe:/a:redhat:enterprise_linux:8::nfv",
			"package": "kernel-rt-0:4.18.0-553.16.1.rt7.357.el8_10",
			"product_name": "Red Hat Enterprise Linux 8",
			"release_date": "2024-08-08T00:00:00Z"
		},
		{
			"advisory": "RHSA-2024:5101",
			"cpe": "cpe:/o:redhat:enterprise_linux:8",
			"package": "kernel-0:4.18.0-553.16.1.el8_10",
			"product_name": "Red Hat Enterprise Linux 8",
			"release_date": "2024-08-08T00:00:00Z"
		}
	],
	"package_state": [
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:6",
			"fix_state": "Out of support scope",
			"package_name": "kernel",
			"product_name": "Red Hat Enterprise Linux 6"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:7",
			"fix_state": "Out of support scope",
			"package_name": "kernel",
			"product_name": "Red Hat Enterprise Linux 7"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:7",
			"fix_state": "Out of support scope",
			"package_name": "kernel-rt",
			"product_name": "Red Hat Enterprise Linux 7"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"fix_state": "Affected",
			"package_name": "kernel",
			"product_name": "Red Hat Enterprise Linux 9"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"fix_state": "Affected",
			"package_name": "kernel-rt",
			"product_name": "Red Hat Enterprise Linux 9"
		}
	],
	"upstream_fix": "kernel 4.19.312, kernel 5.4.274, kernel 5.10.215, kernel 5.15.154, kernel 6.1.84, kernel 6.6.24, kernel 6.7.12, kernel 6.8.3, kernel 6.9",
	"csaw": false
}
