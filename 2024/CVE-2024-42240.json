{
	"name": "CVE-2024-42240",
	"threat_severity": "Moderate",
	"public_date": "2024-08-07T00:00:00Z",
	"bugzilla": {
		"description": "kernel: x86/bhi: Avoid warning in #DB handler due to BHI mitigation",
		"id": "2303508",
		"url": "https://bugzilla.redhat.com/show_bug.cgi?id=2303508"
	},
	"cvss3": {
		"cvss3_base_score": "5.5",
		"cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
		"status": "verified"
	},
	"cwe": "CWE-99",
	"details": [
		"In the Linux kernel, the following vulnerability has been resolved:\nx86/bhi: Avoid warning in #DB handler due to BHI mitigation\nWhen BHI mitigation is enabled, if SYSENTER is invoked with the TF flag set\nthen entry_SYSENTER_compat() uses CLEAR_BRANCH_HISTORY and calls the\nclear_bhb_loop() before the TF flag is cleared. This causes the #DB handler\n(exc_debug_kernel()) to issue a warning because single-step is used outside the\nentry_SYSENTER_compat() function.\nTo address this issue, entry_SYSENTER_compat() should use CLEAR_BRANCH_HISTORY\nafter making sure the TF flag is cleared.\nThe problem can be reproduced with the following sequence:\n$ cat sysenter_step.c\nint main()\n{ asm(\"pushf; pop %ax; bts $8,%ax; push %ax; popf; sysenter\"); }\n$ gcc -o sysenter_step sysenter_step.c\n$ ./sysenter_step\nSegmentation fault (core dumped)\nThe program is expected to crash, and the #DB handler will issue a warning.\nKernel log:\nWARNING: CPU: 27 PID: 7000 at arch/x86/kernel/traps.c:1009 exc_debug_kernel+0xd2/0x160\n...\nRIP: 0010:exc_debug_kernel+0xd2/0x160\n...\nCall Trace:\n<#DB>\n? show_regs+0x68/0x80\n? __warn+0x8c/0x140\n? exc_debug_kernel+0xd2/0x160\n? report_bug+0x175/0x1a0\n? handle_bug+0x44/0x90\n? exc_invalid_op+0x1c/0x70\n? asm_exc_invalid_op+0x1f/0x30\n? exc_debug_kernel+0xd2/0x160\nexc_debug+0x43/0x50\nasm_exc_debug+0x1e/0x40\nRIP: 0010:clear_bhb_loop+0x0/0xb0\n...\n</#DB>\n<TASK>\n? entry_SYSENTER_compat_after_hwframe+0x6e/0x8d\n</TASK>\n[ bp: Massage commit message. ]",
		"A denial of service vulnerability was found in the Linux kernel. When BHI mitigation is enabled, if SYSENTER is invoked with the TF flag set, then entry_SYSENTER_compat() uses CLEAR_BRANCH_HISTORY and calls the clear_bhb_loop() before the TF flag is cleared. This causes the #DB handler (exc_debug_kernel()) to issue a warning that results in a software crash."
	],
	"references": [
		"https://www.cve.org/CVERecord?id=CVE-2024-42240\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-42240\nhttps://lore.kernel.org/linux-cve-announce/2024080741-CVE-2024-42240-3d04@gregkh/T"
	],
	"affected_release": [
		{
			"advisory": "RHSA-2024:7001",
			"cpe": "cpe:/a:redhat:enterprise_linux:8::nfv",
			"package": "kernel-rt-0:4.18.0-553.22.1.rt7.363.el8_10",
			"product_name": "Red Hat Enterprise Linux 8",
			"release_date": "2024-09-24T00:00:00Z"
		},
		{
			"advisory": "RHSA-2024:7000",
			"cpe": "cpe:/o:redhat:enterprise_linux:8",
			"package": "kernel-0:4.18.0-553.22.1.el8_10",
			"product_name": "Red Hat Enterprise Linux 8",
			"release_date": "2024-09-24T00:00:00Z"
		},
		{
			"advisory": "RHSA-2024:9315",
			"cpe": "cpe:/a:redhat:enterprise_linux:9",
			"package": "kernel-0:5.14.0-503.11.1.el9_5",
			"product_name": "Red Hat Enterprise Linux 9",
			"release_date": "2024-11-12T00:00:00Z"
		},
		{
			"advisory": "RHSA-2024:9315",
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"package": "kernel-0:5.14.0-503.11.1.el9_5",
			"product_name": "Red Hat Enterprise Linux 9",
			"release_date": "2024-11-12T00:00:00Z"
		}
	],
	"package_state": [
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:6",
			"fix_state": "Not affected",
			"package_name": "kernel",
			"product_name": "Red Hat Enterprise Linux 6"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:7",
			"fix_state": "Not affected",
			"package_name": "kernel",
			"product_name": "Red Hat Enterprise Linux 7"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:7",
			"fix_state": "Not affected",
			"package_name": "kernel-rt",
			"product_name": "Red Hat Enterprise Linux 7"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"fix_state": "Affected",
			"package_name": "kernel-rt",
			"product_name": "Red Hat Enterprise Linux 9"
		}
	],
	"csaw": false
}
