{
	"name": "CVE-2024-23651",
	"threat_severity": "Moderate",
	"public_date": "2024-01-31T01:01:00Z",
	"bugzilla": {
		"description": "moby/buildkit: possible race condition with accessing subpaths from cache mounts",
		"id": "2262224",
		"url": "https://bugzilla.redhat.com/show_bug.cgi?id=2262224"
	},
	"cvss3": {
		"cvss3_base_score": "7.5",
		"cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:N",
		"status": "draft"
	},
	"cwe": "CWE-362",
	"details": [
		"BuildKit is a toolkit for converting source code to build artifacts in an efficient, expressive and repeatable manner. Two malicious build steps running in parallel sharing the same cache mounts with subpaths could cause a race condition that can lead to files from the host system being accessible to the build container. The issue has been fixed in v0.12.5. Workarounds include, avoiding using BuildKit frontend from an untrusted source or building an untrusted Dockerfile containing cache mounts with --mount=type=cache,source=... options.",
		"A race condition issue was found in the Moby Builder Toolkit, stemming from a time-of-check/time-of-use (TOCTOU) vulnerability during cache volume mounting at container build time. Concurrent execution of two malicious build steps, sharing the same cache mounts with subpaths, may result in files from the host system being accessible to the build container. Successful exploitation could lead to a container escape to the underlying host OS when building an image using a malicious Dockerfile or upstream image (for example, when using FROM)."
	],
	"statement": "This vulnerability can only be exploited when two containers are being built in parallel within the same cache directory. A concurrent running build that has the target cache directory mounted, needs to replace the target directory with a symbolic link between the time it is checked and actually used. As there is an unpredictable race condition, this issue is difficult to exploit. Therefore it is rated as having Moderate severity.",
	"references": [
		"https://www.cve.org/CVERecord?id=CVE-2024-23651\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-23651\nhttps://github.com/moby/buildkit/pull/4604\nhttps://github.com/moby/buildkit/security/advisories/GHSA-m3r6-h7wv-7xxv\nhttps://snyk.io/blog/cve-2024-23651-docker-buildkit-mount-cache-race/\nhttps://www.openwall.com/lists/oss-security/2019/05/28/1"
	],
	"mitigation": {
		"lang": "en:us",
		"value": "Do not use BuildKit frontends or Dockerfiles from untrusted sources."
	},
	"package_state": [
		{
			"cpe": "cpe:/a:redhat:ocp_tools",
			"fix_state": "Not affected",
			"package_name": "odo",
			"product_name": "OpenShift Developer Tools and Services"
		},
		{
			"cpe": "cpe:/a:redhat:serverless:1",
			"fix_state": "Not affected",
			"package_name": "openshift-serverless-1/client-kn-rhel8",
			"product_name": "OpenShift Serverless"
		},
		{
			"cpe": "cpe:/a:redhat:serverless:1",
			"fix_state": "Not affected",
			"package_name": "openshift-serverless-clients",
			"product_name": "OpenShift Serverless"
		},
		{
			"cpe": "cpe:/a:redhat:service_mesh:2",
			"fix_state": "Not affected",
			"package_name": "openshift-service-mesh/istio-cni-rhel8",
			"product_name": "OpenShift Service Mesh 2"
		},
		{
			"cpe": "cpe:/a:redhat:ansible_automation_platform",
			"fix_state": "Not affected",
			"package_name": "openshift-clients",
			"product_name": "Red Hat Ansible Automation Platform 1.2"
		},
		{
			"cpe": "cpe:/a:redhat:ansible_automation_platform:2",
			"fix_state": "Not affected",
			"package_name": "openshift-clients",
			"product_name": "Red Hat Ansible Automation Platform 2"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:8",
			"fix_state": "Not affected",
			"package_name": "container-tools:rhel8/buildah",
			"product_name": "Red Hat Enterprise Linux 8"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:8",
			"fix_state": "Not affected",
			"package_name": "container-tools:rhel8/podman",
			"product_name": "Red Hat Enterprise Linux 8"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"fix_state": "Not affected",
			"package_name": "buildah",
			"product_name": "Red Hat Enterprise Linux 9"
		},
		{
			"cpe": "cpe:/o:redhat:enterprise_linux:9",
			"fix_state": "Not affected",
			"package_name": "podman",
			"product_name": "Red Hat Enterprise Linux 9"
		},
		{
			"cpe": "cpe:/a:redhat:openshift:4",
			"fix_state": "Not affected",
			"package_name": "openshift-clients",
			"product_name": "Red Hat OpenShift Container Platform 4"
		},
		{
			"cpe": "cpe:/a:redhat:openshift_devspaces:3::el8",
			"fix_state": "Affected",
			"package_name": "devspaces/traefik-rhel8",
			"product_name": "Red Hat OpenShift Dev Spaces"
		},
		{
			"cpe": "cpe:/a:redhat:quay:3",
			"fix_state": "Affected",
			"package_name": "quay/quay-builder-rhel8",
			"product_name": "Red Hat Quay 3"
		}
	],
	"upstream_fix": "buildkit 0.12.5",
	"csaw": true
}
